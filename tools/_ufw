#!/bin/bash
# Description: Linux UFW (Firewall)
set -e

UFW_IPV4='to 0.0.0.0/0'

if command -v csf; then
    _msg "[ufw] ${Yellow}csf${Normal} is already installed, skipping."
    exit_with_error
fi

if command -v imunify360-agent; then
    _msg "[ufw] ${Yellow}imunify360${Normal} is already installed, skipping."
    exit_with_error
fi

if command -v iptables; then
    _run "[ufw] Stop ${Yellow}iptables${Normal}" systemctl stop iptables
    _run "[ufw] Disable ${Yellow}iptables${Normal}" systemctl disable iptables
fi

if command -v firewall-cmd; then
    _run "[ufw] Stop ${Yellow}firewalld${Normal}" systemctl stop firewalld
    _run "[ufw] Disable ${Yellow}firewalld${Normal}" systemctl disable firewalld
fi

if command -v ufw; then
    _msg "[ufw] Command ${Yellow}ufw${Normal} ${Blue}-->${Normal} ${Yellow}OK${Normal}"
else
    _msg "[ufw] Command ${Yellow}ufw${Normal} does not exist."
    exit_with_error
fi

function _ufw_add {
    _run "[ufw] UFW Allow ${Yellow}$1${Normal} $2" ufw allow $UFW_IPV4 port $1 comment "$2"
}
