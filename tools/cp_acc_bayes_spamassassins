#!/bin/bash
# Description: cPanel Account Bayes Spamassassins [All]
# Arguments: --domain=DOMAIN
set -e

_tool _cp
_domain ${DOMAIN}
local ACCOUNT=${account}

# Force a database sync and expiry run
_run "[$1] Force a database sync and expiry run" /usr/local/cpanel/3rdparty/bin/sa-learn --force-expire

## Check file bayes_journal
BAYES_JOURNAL=/home/${ACCOUNT}/.spamassassin/bayes_journal
if [ -f ${BAYES_JOURNAL} ]; then
    _run "[$1] Remove ${Yellow}${BAYES_JOURNAL}${Normal}" rm -rf ${BAYES_JOURNAL}
else
    _msg "[$1] File ${Yellow}${BAYES_JOURNAL}${Normal} ${Red}does not exist${Normal}."
fi

## Check file bayes_seen
BAYES_SEEN=/home/${ACCOUNT}/.spamassassin/bayes_seen
if [ -f ${BAYES_SEEN} ]; then
    _run "[$1] Remove ${Yellow}${BAYES_SEEN}${Normal}" rm -rf ${BAYES_SEEN}
else
    _msg "[$1] File ${Yellow}${BAYES_SEEN}${Normal} ${Red}does not exist${Normal}."
fi

## Check file bayes_toks
BAYES_TOKS=/home/${ACCOUNT}/.spamassassin/bayes_toks
if [ -f ${BAYES_TOKS} ]; then
    _run "[$1] Remove ${Yellow}${BAYES_TOKS}${Normal}" rm -rf ${BAYES_TOKS}
else
    _msg "[$1] File ${Yellow}${BAYES_TOKS}${Normal} ${Red}does not exist${Normal}."
fi

_restart spamd
